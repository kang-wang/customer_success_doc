# 常用前端函数

<a name="e612c972"></a>
# 1 前端扩展开发指导

<br />通过图片来理解界面上元素分别是由什么model构成，在需要对相关控件进行扩展时， 调用相应model的方法及事件。<br />
<br />[前端扩展开发指导](http://tinper.org/mdf/docs#/ak8rsd.html)
<a name="cf041cb6"></a>
# 2 常用前端函数
<a name="8a1c31a5"></a>
## 页面初始化->设置默认值（前端函数）


```javascript
function (event) {
  viewModel.get('userid').setValue(newPseudoGuid());
  viewModel.get('startdate').setValue(formatDate(new Date()));
  function formatDate(date){
    var month = date.getMonth()+1;
    return date.getFullYear()+"-"+month+"-"+date.getDate()
  }
}
```


<a name="e6e21600"></a>
## 初始化自定义按钮绑定点击事件


```javascript
function (event) {
  var viewModel = this;
  viewModel.get('button5ad').on('click', function () {
    var rows = viewModel.getGridModel().getSelectedRows();
    console.log(rows);
  })
}
```


<a name="1ca1c93c"></a>
## 保存前校验


```javascript
function (event) {
  var viewModel = this;
  //设置保存前校验
  viewModel.on("beforeSave", function(args){
      var jieyongriqi = viewModel.get("jieyongriqi").getValue();
      var guihairiqi = viewModel.get("guihairiqi").getValue();
      const isAfterDate = (dateA, dateB) => dateA > dateB;
      if(!isAfterDate(guihairiqi, jieyongriqi)){
        cb.utils.alert("归还日期要大于借用日期")
        return false;
      }
  })
}
```


<a name="d908fa6a"></a>

## 列表批量删除及表格行删除

绑定到列表初始化函数里面
```
function (event) {
  var viewModel = this;
  viewModel.on('beforeBatchdelete',function(params){
    var check = true;
    var selected = JSON.parse(params.data.data);
    selected.forEach((row)=>{
      //row循环的行数据
      if('2' ==row.new1){
        check = false;
        return;
      }
    });
    return check;
  });
} 

```


## 卡片页面删除

```
function (event) {
  var viewModel = this;
  viewModel.on('beforeDelete',function(params){
    var data = JSON.parse(params.data.data);
    if('2' ==data.new1){
        return false;
    }
  });
}

```


<a name="6b4e4428"></a>
## 表格选中行


```javascript
function (event) {
  var viewModel = this;
  var gridModel = viewModel.getGridModel();
  gridModel.on('afterSelect', function (data) {
		cb.utils.alert(data);
	});
}
```


<a name="6b01a2fb"></a>
## 卡片界面根据页面状态按钮控制显示


```javascript
function (event) {
  var viewModel = this;
  viewModel.on("modeChange",function (data) {
	        if(data == "add"){
	          	viewModel.get("button24rj").setVisible(true);
	        }else{
	        	  viewModel.get("button24rj").setVisible(false);
	        }
	  	});
}
```


<a name="e496c8f6"></a>
## 表格自定义按钮获取选中行数据


```javascript
function (event) {
  var viewModel = this;
  viewModel.get('button5vf').on('click', function (args) {
    var currentRow = viewModel.getGridModel().getRow(args.index);
  })
}
```


<a name="846b6107"></a>
## 卡片界面枚举清空及设置默认值


```javascript
  //ListModel方法及事件
   var sexModel=viewModel.get("sex");  //获取ListModel
   
   sexModel.clear();//ListModel清空方法
   
   sexModel.setValue(2); //ListModel设值
```


<a name="21d0f96e"></a>
## 删行前弹出确定框


```javascript
function (event) {
  var viewModel = this;
  viewModel.on("beforeDeleteRow",function (args) {
	     var returnPromise = new cb.promise();
	          cb.utils.confirm('确定要停用吗？', function(){
	            //获取选中行
	            var data = viewModel.getGridModel().getRows()[args.data[0]];
	            return returnPromise.resolve();
	          },function (args) {
	            cb.utils.alert("点击了取消");
	            returnPromise.reject();
	          });
	          return returnPromise;
	 	});
}
```


<a name="84be6bd5"></a>
## 联动动态控制组件是否可编辑


```javascript
function (event) {
  var viewModel = this;
  var sexModel=viewModel.get("sex");  //获取ListModel
  sexModel.on('afterValueChange',function(data){
       if(data.value.value=="1"){
         let phoneModel=viewModel.get("phone"); //获取手机控件
         phoneModel.setVisible(true);
         gridModel.setReadOnly(false); //设置gridModel可编辑

       }
}
```


<a name="d383ea97"></a>
## 动态设置控件状态


```javascript
function (event) {
  var viewModel = this;
  var param = viewModel.get("new1");
  param.setState("bIsNull",false);
  cb.utils.alert(param);
}
```


<a name="HWeZT"></a>
## 删除行后处理
```javascript
function (event) {
  var viewModel = this;
  viewModel.on('afterDeleteRow', function (args) {
      var rows = viewModel.getGridModel().getRows();
      if(rows.length>0){
        var totaldata = 0;
        rows.forEach(data => {
          if(data.jine==""||data.jine==undefined)data.jine=0;
          totaldata+=data.jine;
        });
        viewModel.get("zongjine").setValue(totaldata);
      }
  });
}
```


<a name="jXvXl"></a>
## 编辑表格单元格后事件
```javascript
function (event) {
  var viewModel = this;
  var gridModel = viewModel.getGridModel();
  gridModel.on("afterCellValueChange",function(data){
      var cellName = data.cellName;
      if(cellName=='jine'){
         var rows = viewModel.getGridModel().getRows();
        if(rows.length>0){
          var totaldata = 0;
          rows.forEach(data => {
            if(data.jine==""||data.jine==undefined)data.jine=0;
            totaldata+=data.jine;
          });
          viewModel.get("zongjine").setValue(totaldata);
        }
      }
  });
}
```

## 表格里面的参照实现过滤

```javascript
function (event) {
  var viewModel = this;
  var girdModel = viewModel.getGridModel();
  girdModel.getEditRowModel().get('ref1022_id').on('beforeBrowse', function (data) {
                    var condition = {
                        "isExtend": true,
                        simpleVOs: []
                    };
                    condition.simpleVOs.push({
                        field: 'new1',
                        op: 'eq',
                        value1: 11
                    });
                    this.setFilter(condition);
                });
} 
```

## 监听图片改变事件

```javascript

function (event) {
  var viewModel = this;
  var picture = viewModel.get("tupian");
  picture.on('onChange',function(date){
     filelist = date.fileList;
     console.log(filelist);
   });
}

```

## 常用事件函数

```javascript

//设置时间
  var formatDate = function (date){
    var y = date.getFullYear();
    var m = date.getMonth()+1;
    m = m < 10 ? '0' + m : m;
    var d = date.getDate();
    d = d < 10 ? ('0'+d )  : d; 
    return y + '-' + m + '-' + d;
    
  };
  //设置时间带时分秒
  var formatDateTime = function(date){
    var y = date.getFullYear();
    var m = date.getMonth()+1;
    m = m < 10 ? '0' +m : m;
    var d = date.getDate();
    d = d < 10 ? ('0'+d) : d;
    var hh = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
    var mm = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
    var ss = date.getSeconds() < 10 ? "0" + date.getSeonds() : date.getSeconds();
    return y + '-' + m + '-' + d + ' '  + hh + ':' + mm + ':' + ss;
    
    
  };

```

## 常用判断字符串是否为空

```javascript

//判断字符是否为空的方法
  function isEmpty(obj){
    if(typeof obj == "undefined" || obj == null || obj == ""){
        return true;
    }else{
        return false;
    }
  }

```



## 参照框确定按钮监听事件

```javascript

var ref = viewModel.get('ref_name');
ref.on('afterReferOkClick',function(data){
   //参照选择的数据
   console.log(data);
})

```

## 前端直接请求第三方接口

可能会存在跨域问题，建议通过后端请求第三方

```javascript

function  get (data,callback) {
    window.URL = window.URL || window.webkitURL;
    var xhr = new XMLHttpRequest();
    xhr.open("get", data, true);
    xhr.responseType = "blob";
    xhr.onload = function () {
      if (this.status == 200) {
        var blob = this.response;
        callback();
      }
    };
    xhr.send();
  };

```

## 触发打开另一个单据页面

```javascript

function (event) {
  var viewModel = this;
  let data = {
    billtype: 'Voucher',// 单据类型
    billno: '68081b7b',// 单据号
    params: {
      mode: 'add', // (编辑态、新增态、浏览态)
    },
  };
  cb.loader.runCommandLine('bill', data, viewModel);
}

//-----------------------------------------------------------------

function (event) {
  var viewModel = this;
  var line  = event.params.index;
  var id = viewModel.getGridModel().getRow(line).id;
  let data = {
    billtype: 'Voucher',// 单据类型
    billno: '68081b7b',// 单据号
    params: {
      mode: 'edit', // (编辑态、新增态、浏览态)
      id:id
    },
  };
  cb.loader.runCommandLine('bill', data, viewModel);
}

```

## 获取卡片页面的单据状态

```javascript

var currentState = viewModel.getParams().mode;

```

## 查询区动态设置默认值并过滤

```javascript
function (event) {
  var viewModel = this;
  var bh = viewModel.get("params").abnormalevent;
  viewModel.on('afterMount', function(){
    // 获取查询区模型
    const filtervm = viewModel.getCache('FilterViewModel'); 
    filtervm.on('afterInit', function () {
      // 进行查询区相关扩展
      filtervm.get('abnormalevent').getFromModel().setValue(bh);
      });
  });
}

```

## 设置表格整行禁用

```javascript
var gridModel = viewModel.getGridModel();
gridModel.setRowState(行号,'disabled',true);

```

## 卡片页面设置系统按钮的隐藏

```javascript
function (event) {
  var viewModel = this;
    viewModel.on('afterRule',function(event){
    viewModel.get('btnBizFlowPush').setVisible(false);
  })
} 

```

## 设置布局(容器)的隐藏

```javascript
viewmodel.execute('updateViewMeta', { code: 'cGroupCode', visible: false });

```

## 列表页面数据取消自动查询

```javascript

function (event) {
  var viewModel = this;
  viewModel.getParams().autoLoad = false;
} 

```

## 更改输入框为密码框

```javascript
function (event) {
  var viewModel = this;
  viewModel.on('afterMount',function(){
    //ID:  页面编码|字段编码
    var inputPas = document.getElementById("9978d74e|new1").getElementsByTagName("input")[0];
    inputPas.type = 'password';
  });
}
```

## 设置树结构显示多个字段

```javascript

function (event) {
  var viewModel = this;
  viewModel.on('afterMount',function(){
    var treeModel = viewModel.getTreeModel();
    treeModel.setState('titleField',['code','name'])
  })
} 
```

## 多个表格情况下，获取指定表格

```javascript

function (event) {
  var viewModel = this;
  //表格的childrenfield属性值
  var gridmodel = viewModel.get('childrenfield');
} 

```












