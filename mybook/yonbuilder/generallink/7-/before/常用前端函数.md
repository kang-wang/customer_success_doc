# 常用前端函数

<a name="e612c972"></a>
# 1 前端扩展开发指导

<br />通过图片来理解界面上元素分别是由什么model构成，在需要对相关控件进行扩展时， 调用相应model的方法及事件。例如需要对下拉项——性别进行扩展，在选中下拉中的性别为女时， 设置界面上是否怀孕为可编辑；选中下拉中的性别为男，设置界面上是否怀孕为不可编辑。 此时需要获取的model为下拉项对应的ListModel，调用ListModel的afterSelect事件， 获取ListModel选中的值进行判断，然后设置是否怀孕控件的可编辑状态。<br />
<br />[前端扩展开发指导](http://tinper.org/mdf/docs#/ak8rsd.html)
<a name="cf041cb6"></a>
# 2 常用前端函数
<a name="8a1c31a5"></a>
## 2.1 页面初始化->设置默认值（前端函数）


```javascript
function (event) {
  viewModel.get('userid').setValue(newPseudoGuid());
  viewModel.get('startdate').setValue(formatDate(new Date()));
  function formatDate(date){
    var month = date.getMonth()+1;
    return date.getFullYear()+"-"+month+"-"+date.getDate()
  }
}
```


<a name="e6e21600"></a>
## 2.2 初始化自定义按钮绑定点击事件


```javascript
function (event) {
  var viewModel = this;
  viewModel.get('button5ad').on('click', function () {
    var rows = viewModel.getGridModel().getSelectedRows();
    console.log(rows);
  })
}
```


<a name="1ca1c93c"></a>
## 2.3 保存前校验


```javascript
function (event) {
  var viewModel = this;
  //设置保存前校验
  viewModel.on("beforeSave", function(args){
      var jieyongriqi = viewModel.get("jieyongriqi").getValue();
      var guihairiqi = viewModel.get("guihairiqi").getValue();
      const isAfterDate = (dateA, dateB) => dateA > dateB;
      if(!isAfterDate(guihairiqi, jieyongriqi)){
        cb.utils.alert("归还日期要大于借用日期")
        return false;
      }
  })
}
```


<a name="d908fa6a"></a>
## 2.4 列表删除前校验


```javascript
function (event) {
  var viewModel = this;
  let gridModel = viewModel.getGridModel();
  const actionsStates = [];
  //删除前校验
  viewModel.on("beforeBatchdelete", function(args){
      const rows = gridModel.getSelectedRows();
      rows.forEach(data => {
				if(data.shebeizhuangtai==1){
				  actionsStates.push("编码:"+data.code+"为在用设备不能删除");
				}
			});
			if(actionsStates.length>0){
        cb.utils.alert(actionsStates);
        actionsStates.splice(0,actionsStates.length);
        return false;
      }
  })
}
```


<a name="6b4e4428"></a>
## 2.5 表格选中行


```javascript
function (event) {
  var viewModel = this;
  var gridModel = viewModel.getGridModel();
  gridModel.on('afterSelect', function (data) {
		cb.utils.alert(data);
	});
}
```


<a name="6b01a2fb"></a>
## 2.6 卡片界面根据页面状态按钮控制显示


```javascript
function (event) {
  var viewModel = this;
  viewModel.on("modeChange",function (data) {
	        if(data == "add"){
	          	viewModel.get("button24rj").setVisible(true);
	        }else{
	        	  viewModel.get("button24rj").setVisible(false);
	        }
	  	});
}
```


<a name="e496c8f6"></a>
## 2.7 表格自定义按钮获取选中行数据


```javascript
function (event) {
  var viewModel = this;
  viewModel.get('button5vf').on('click', function (args) {
    var currentRow = viewModel.getGridModel().getRow(args.index);
  })
}
```


<a name="846b6107"></a>
## 2.8 卡片界面枚举清空及设置默认值


```javascript
  //ListModel方法及事件
   var sexModel=viewModel.get("sex");  //获取ListModel
   
   sexModel.clear();//ListModel清空方法
   
   sexModel.setValue(2); //ListModel设值
```


<a name="555c54a3"></a>
## 2.9 设置参照过滤


```javascript
    //ReferModel方法及事件
   var nationModel=viewModel.get("nation_name");  //获取ReferModel
   var nationFiter = { 
     "isExtend": true,
       simpleVOs: []
         };
    nationFiter.simpleVOs.push({
       field: 'name',
       op: 'eq',
       value1: '汉族'
    });
    nationModel.setFilter(nationFiter);//设置过滤
```



<a name="21d0f96e"></a>
## 2.11 删行前弹出确定框


```javascript
function (event) {
  var viewModel = this;
  viewModel.on("beforeDeleteRow",function (args) {
	     var returnPromise = new cb.promise();
	          cb.utils.confirm('确定要停用吗？', function(){
	            //获取选中行
	            var data = viewModel.getGridModel().getRows()[args.data[0]];
	            return returnPromise.resolve();
	          },function (args) {
	            cb.utils.alert("点击了取消");
	            returnPromise.reject();
	          });
	          return returnPromise;
	 	});
}
```


<a name="84be6bd5"></a>
## 2.12 联动动态控制组件是否可编辑


```javascript
function (event) {
  var viewModel = this;
  var sexModel=viewModel.get("sex");  //获取ListModel
  sexModel.on('afterValueChange',function(data){
       if(data.value.value=="1"){
         let phoneModel=viewModel.get("phone"); //获取手机控件
         phoneModel.setVisible(true);
         gridModel.setReadOnly(false); //设置gridModel可编辑

       }
}
```


<a name="d383ea97"></a>
## 2.13 动态设置控件状态


```javascript
function (event) {
  var viewModel = this;
  var param = viewModel.get("new1");
  param.setState("bIsNull",false);
  cb.utils.alert(param);
}
```


<a name="HWeZT"></a>
## 2.14 删除行后处理
```javascript
function (event) {
  var viewModel = this;
  viewModel.on('afterDeleteRow', function (args) {
      var rows = viewModel.getGridModel().getRows();
      if(rows.length>0){
        var totaldata = 0;
        rows.forEach(data => {
          if(data.jine==""||data.jine==undefined)data.jine=0;
          totaldata+=data.jine;
        });
        viewModel.get("zongjine").setValue(totaldata);
      }
  });
}
```


<a name="jXvXl"></a>
## 2.15 编辑表格单元格后事件
```javascript
function (event) {
  var viewModel = this;
  var gridModel = viewModel.getGridModel();
  gridModel.on("afterCellValueChange",function(data){
      var cellName = data.cellName;
      if(cellName=='jine'){
         var rows = viewModel.getGridModel().getRows();
        if(rows.length>0){
          var totaldata = 0;
          rows.forEach(data => {
            if(data.jine==""||data.jine==undefined)data.jine=0;
            totaldata+=data.jine;
          });
          viewModel.get("zongjine").setValue(totaldata);
        }
      }
  });
}
```
