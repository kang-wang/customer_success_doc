# 一、系统预制功能扩展方式



<a name="3165163d"></a>
# 编写规则

<br />![](https://cdn.nlark.com/yuque/0/2020/jpeg/1431516/1599135486348-80dfbe8d-a134-47ac-8282-5c6ba58af3d5.jpeg#align=left&display=inline&height=387&margin=%5Bobject%20Object%5D&originHeight=860&originWidth=1512&size=0&status=done&style=none&width=680)<br />图1<br />

<a name="56f26342"></a>
## 规则一


```java
package com.yonyou.ucf.mdf.domain.rules;

import com.yonyou.ucf.mdd.common.interfaces.context.ISimpleUser;
import com.yonyou.ucf.mdd.common.model.rule.RuleContext;
import com.yonyou.ucf.mdd.common.model.rule.RuleExecuteResult;
import com.yonyou.ucf.mdd.common.model.uimeta.UIMetaBaseInfo;
import com.yonyou.ucf.mdd.rule.base.AbstractRule;
import com.yonyou.ucf.mdf.app.exceptions.BusinessException;
import com.yonyou.ucf.mdf.domain.util.CommonUtil;
import org.imeta.orm.base.BizObject;
import org.springframework.stereotype.Component;

import java.util.Iterator;
import java.util.List;

/**
 * @author nishch
 * @version 1.0
 * @date 2020/4/14
 * @des
 */
@Component("activityRule")
public class ActivityRule extends AbstractRule {



    @Override
    public <T> RuleExecuteResult execute(RuleContext ruleContext, T... tObjs) throws Exception {
        //获取当前用户信息
        ISimpleUser user = CommonUtil.getCurrentUser();
        //获取UI元数据
        UIMetaBaseInfo uiMetaBaseInfo = ruleContext.getUiMetaBaseInfo();
        //取业务数据
        List<BizObject> bizObjectList = this.getBizObjects(uiMetaBaseInfo, ruleContext);
        Iterator var6 = bizObjectList.iterator();
        while(var6.hasNext()) {
            BizObject bizObject = (BizObject)var6.next();
            if(null==bizObject.get("name")){
                throw  new BusinessException("不能为空");
            }
        }
        //规则间数据传递
        ruleContext.setCusMapValue("mycontent","12345");
        return new RuleExecuteResult();
    }
}
```


<a name="cadda7bb"></a>
## 规则二


```java
package com.yonyou.ucf.mdf.domain.rules;

import com.yonyou.ucf.mdd.common.model.rule.RuleContext;
import com.yonyou.ucf.mdd.common.model.rule.RuleExecuteResult;
import com.yonyou.ucf.mdd.common.model.uimeta.UIMetaBaseInfo;
import com.yonyou.ucf.mdd.rule.base.AbstractRule;
import com.yonyou.ucf.mdf.domain.service.MddActivityService;
import org.imeta.orm.base.BizObject;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import org.springframework.stereotype.Service;

import java.util.List;

/**
 * @author nishch
 * @version 1.0
 * @date 2020/4/14
 * @des
 */
@Component("activityRule2")
public class ActivityRule2 extends AbstractRule {


    @Autowired
    MddActivityService mddActivityService;

    @Override
    public <T> RuleExecuteResult execute(RuleContext ruleContext, T... tObjs) throws Exception {
        //获取上个规则设置的值
        String preRule =ruleContext.getCusMapValue("mycontent").toString();
        System.out.println(preRule);
        //调用数据库操作
        UIMetaBaseInfo uiMetaBaseInfo = ruleContext.getUiMetaBaseInfo();
        //获取实体
        List<BizObject> bizObjectList = this.getBizObjects(uiMetaBaseInfo, ruleContext);
        BizObject bizObject = bizObjectList.get(0);
        mddActivityService.select(bizObject);
        return new RuleExecuteResult();
    }
}
```


<a name="3138d486"></a>
# 绑定规则

<br />![](https://cdn.nlark.com/yuque/0/2020/jpeg/1431516/1599135486353-a9e46b2b-019f-4ed2-be64-63e64a12eb43.jpeg#align=left&display=inline&height=337&margin=%5Bobject%20Object%5D&originHeight=944&originWidth=1904&size=0&status=done&style=none&width=680)<br />图2<br />![](https://cdn.nlark.com/yuque/0/2020/png/1431516/1599135486355-4c77b631-8e87-4926-b419-2b50d007d8e7.png#align=left&display=inline&height=267&margin=%5Bobject%20Object%5D&originHeight=566&originWidth=1442&size=0&status=done&style=none&width=680)<br />图3<br />![](https://cdn.nlark.com/yuque/0/2020/jpeg/1431516/1599135486400-75828667-b48a-441d-8cc9-4720f1fd11b3.jpeg#align=left&display=inline&height=363&margin=%5Bobject%20Object%5D&originHeight=911&originWidth=1707&size=0&status=done&style=none&width=680)<br />图4<br />
<br />#测试
